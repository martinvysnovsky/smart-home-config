# ================================================================================
# Scene Management - Presence-based automation for home and away modes
# ================================================================================

- id: '1696262663910'
  alias: Enable Home scene when someone enters home
  description: Activates home mode by turning on input_boolean when anyone arrives
    at the main home
  triggers:
  - trigger: state
    entity_id:
    - zone.home
    from: '0'
  conditions: []
  actions:
  - action: input_boolean.turn_on
    target:
      entity_id: input_boolean.home_away_mode
  mode: single

- id: '1696262790329'
  alias: Enable Away scene when everybody leave home
  description: Activates away mode by turning off input_boolean when everyone leaves
    the main home
  triggers:
  - trigger: state
    entity_id:
    - zone.home
    to: '0'
    for: '00:01:00'
  conditions: []
  actions:
  - action: input_boolean.turn_off
    target:
      entity_id: input_boolean.home_away_mode
  mode: single

- id: '1737825600001'
  alias: Trigger scene based on Home/Away mode
  description: Activates appropriate scene when home/away mode input_boolean changes
  triggers:
  - trigger: state
    entity_id: input_boolean.home_away_mode
    to: 'on'
    id: home
  - trigger: state
    entity_id: input_boolean.home_away_mode
    to: 'off'
    id: away
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: home
      sequence:
      - action: scene.turn_on
        target:
          entity_id: scene.home
    - conditions:
      - condition: trigger
        id: away
      sequence:
      - action: scene.turn_on
        target:
          entity_id: scene.away
  mode: single

- id: '1696358130652'
  alias: Enable Away from Kvetoslavov scene when everybody leaves Kvetoslavov
  description: Activates away mode by turning off input_boolean when everyone leaves
    Kvetoslavov
  triggers:
  - trigger: state
    entity_id:
    - zone.kvetoslavov_home
    from:
    to: '0'
    for: '00:01:00'
  conditions: []
  actions:
  - action: input_boolean.turn_off
    target:
      entity_id: input_boolean.kvetoslavov_home_away_mode
  mode: single

- id: '1696358193297'
  alias: Enable In Kvetoslavov scene when someone enters Kvetoslavov
  description: Activates home mode by turning on input_boolean when anyone arrives
    at Kvetoslavov
  triggers:
  - trigger: state
    entity_id:
    - zone.kvetoslavov_home
    from: '0'
    to:
  conditions: []
  actions:
  - action: input_boolean.turn_on
    target:
      entity_id: input_boolean.kvetoslavov_home_away_mode
  mode: single

- id: '1737825600002'
  alias: Trigger scene based on Kvetoslavov Home/Away mode
  description: Activates appropriate scene when Kvetoslavov home/away mode input_boolean
    changes
  triggers:
  - trigger: state
    entity_id: input_boolean.kvetoslavov_home_away_mode
    to: 'on'
    id: home
  - trigger: state
    entity_id: input_boolean.kvetoslavov_home_away_mode
    to: 'off'
    id: away
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: trigger
        id: home
      sequence:
      - action: scene.turn_on
        target:
          entity_id: scene.in_kvetoslavov
    - conditions:
      - condition: trigger
        id: away
      sequence:
      - action: scene.turn_on
        target:
          entity_id: scene.away_from_kvetoslavov
  mode: single

# ================================================================================
# Vacuum Cleaning - Automated vacuum scheduling based on presence
# ================================================================================

- id: '1733918666189'
  alias: Start Xiaomi when leaving home
  description: Starts Xiaomi vacuum in sweeping mode when everyone leaves home during
    daytime (08:00-22:00)
  triggers:
  - entity_id:
    - person.martin_vysnovsky
    - person.lidia_silanteva
    zone: zone.home
    event: leave
    trigger: zone
  conditions:
  - condition: state
    entity_id: zone.home
    state: '0'
  - condition: time
    after: 08:00:00
    before: '22:00:00'
  - condition: numeric_state
    entity_id: sensor.xiaomi_robot_vacuum_x20_battery_level
    above: 20
  actions:
  - action: input_boolean.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: input_boolean.cleanup_started_by_automation
  - action: select.select_option
    target:
      entity_id: select.xiaomi_robot_vacuum_x20_cleaning_mode
    data:
      option: sweeping
  - action: vacuum.start
    metadata: {}
    data: {}
    target:
      entity_id:
      - vacuum.xiaomi_robot_vacuum_x20
  mode: single

- id: '1733918504232'
  alias: Dock Xiaomi when entering home
  description: Returns Xiaomi vacuum to dock when someone arrives home if it was started
    by automation
  triggers:
  - trigger: state
    entity_id:
    - zone.home
    from: '0'
    to:
  conditions:
  - condition: state
    entity_id: vacuum.xiaomi_robot_vacuum_x20
    state: cleaning
  - condition: state
    entity_id: input_boolean.cleanup_started_by_automation
    state: 'on'
  actions:
  - action: vacuum.return_to_base
    target:
      entity_id: vacuum.xiaomi_robot_vacuum_x20
  mode: single

- id: '1736416573587'
  alias: Reset flag Cleanup started by automation
  description: Resets the automation flag when Xiaomi vacuum returns to dock
  triggers:
  - trigger: state
    entity_id: vacuum.xiaomi_robot_vacuum_x20
    to: docked
  conditions: []
  actions:
  - action: input_boolean.turn_off
    metadata: {}
    data: {}
    target:
      entity_id: input_boolean.cleanup_started_by_automation
  mode: single

- id: '1732550000001'
  alias: Notify on vacuum error during automated cleaning
  description: Sends notification when vacuum encounters error during automated cleaning
    and resets automation flag (only during waking hours)
  triggers:
  - trigger: state
    entity_id: vacuum.xiaomi_robot_vacuum_x20
    to: error
  conditions:
  - condition: state
    entity_id: input_boolean.cleanup_started_by_automation
    state: 'on'
  - condition: state
    entity_id: input_boolean.sleep_mode
    state: 'off'
  actions:
  - action: notify.all_users
    data:
      message: Vacuum encountered an error during automated cleaning
      title: Vacuum Error
      data:
        priority: high
        channel: important
        tag: vacuum_error
  - action: input_boolean.turn_off
    metadata: {}
    data: {}
    target:
      entity_id: input_boolean.cleanup_started_by_automation
  mode: single

# ================================================================================
# Pet Care - Litter robot and bathroom cleaning automation
# ================================================================================

- id: '1733920534581'
  alias: Clean bathroom after Litter Robot run
  description: Triggers bathroom cleaning with Xiaomi vacuum after Litter Robot finishes
    cleaning cycle (only when not in sleep mode)
  triggers:
  - trigger: state
    entity_id:
    - sensor.litter_robot_4_status_code
    to:
    - ccp
  conditions:
  - condition: state
    entity_id: input_boolean.sleep_mode
    state: 'off'
  - condition: not
    conditions:
    - condition: state
      entity_id: vacuum.xiaomi_robot_vacuum_x20
      state: cleaning
  actions:
  - action: script.clean_bathroom
    metadata: {}
    data: {}
  mode: single

- id: '1736690440951'
  alias: Litter-robot waste full
  description: Sends notification when Litter Robot waste drawer reaches 70% capacity
    (waits until morning if triggered during sleep hours)
  triggers:
  - trigger: numeric_state
    entity_id:
    - sensor.litter_robot_4_waste_drawer
    above: 70
  conditions: []
  actions:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.sleep_mode
        state: 'on'
      sequence:
      - wait_for_trigger:
        - trigger: state
          entity_id: input_boolean.sleep_mode
          to: 'off'
        timeout: '12:00:00'
        continue_on_timeout: false
  - action: notify.all_users
    data:
      message: Litter-robot waste above 70%
      title: Litter Robot
      data:
        priority: high
        channel: important
        tag: litter_robot_waste
  mode: single

# ================================================================================
# Day/Night Management - Sunrise and sunset automation for curtains
# ================================================================================

- id: '1736274045296'
  alias: Activate day mode
  description: Opens living room curtains, sets day mode flag, and switches to light
    theme at sunrise
  triggers:
  - trigger: sun
    event: sunrise
    offset: 0
  conditions: []
  actions:
  - action: scene.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: scene.day_mode
  - action: frontend.set_theme
    data:
      name: Catppuccin Latte
  mode: single

- id: '1736274083799'
  alias: Activate night mode
  description: Closes living room curtains, sets night mode flag, and switches to
    dark theme at sunset
  triggers:
  - trigger: sun
    event: sunset
    offset: 0
  conditions: []
  actions:
  - action: scene.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: scene.night_mode
  - action: frontend.set_theme
    data:
      name: Catppuccin Mocha
  mode: single

# ================================================================================
# Sleep Mode Management - Quiet hours for notifications and automations
# ================================================================================

- id: '1732560000001'
  alias: Enable sleep mode at night
  description: Activates sleep mode at 21:30 to suppress non-critical notifications
    and automations
  triggers:
  - trigger: time
    at: '21:30:00'
  conditions: []
  actions:
  - action: input_boolean.turn_on
    target:
      entity_id: input_boolean.sleep_mode
  mode: single

- id: '1732560000002'
  alias: Disable sleep mode in morning
  description: Deactivates sleep mode at 08:00 to resume normal notifications and
    automations
  triggers:
  - trigger: time
    at: '08:00:00'
  conditions: []
  actions:
  - action: input_boolean.turn_off
    target:
      entity_id: input_boolean.sleep_mode
  mode: single

# ================================================================================
# Location-based Notifications - Context-aware mobile alerts
# ================================================================================

- id: '1696626728530'
  alias: Open shopping list when entering a shop
  description: Sends notification with shopping list link when either person enters
    Lidl
  triggers:
  - trigger: zone
    entity_id: person.martin_vysnovsky
    zone: zone.lidl
    event: enter
    id: martin
  - trigger: zone
    entity_id: person.lidia_silanteva
    zone: zone.lidl
    event: enter
    id: lidia
  conditions: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: martin
      sequence:
      - action: notify.martin_devices
        data:
          message: Open your shopping list?
          data:
            clickAction: /lovelace/shopping-list
            url: /lovelace/shopping-list
          title: Shopping list
    - conditions:
      - condition: trigger
        id: lidia
      sequence:
      - action: notify.lidia_devices
        data:
          message: Open your shopping list?
          data:
            clickAction: /lovelace/shopping-list
            url: /lovelace/shopping-list
          title: Shopping list
  mode: single
