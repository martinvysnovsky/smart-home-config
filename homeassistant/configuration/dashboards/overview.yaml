# ================================================================================
# Main Home Dashboard
# ================================================================================
# Primary dashboard with person tracking, weather, batteries, home controls,
# motion detection, and climate monitoring

title: Home
views:
  - title: HOME
    icon: ""
    theme: catppuccin-mocha
    type: sections
    max_columns: 4
    badges:
      - type: entity
        show_name: false
        show_state: true
        show_icon: true
        color: ""
        entity: sensor.living_room_temperature
      - type: entity
        show_name: false
        show_state: true
        show_icon: true
        entity: sensor.living_room_temperature_humidity
        color: ""
      - type: entity
        show_name: true
        show_state: false
        show_icon: true
        entity: scene.day_mode
        color: amber
        tap_action:
          action: perform-action
          perform_action: scene.turn_on
          target:
            entity_id: scene.night_mode
        visibility:
          - condition: state
            entity: input_boolean.day_night
            state: "on"
      - type: entity
        show_name: true
        show_state: false
        show_icon: true
        entity: scene.night_mode
        color: indigo
        tap_action:
          action: perform-action
          perform_action: scene.turn_on
          target:
            entity_id: scene.day_mode
          data: {}
        visibility:
          - condition: state
            entity: input_boolean.day_night
            state: "off"
      - type: entity
        show_name: false
        show_state: true
        show_icon: true
        entity: sensor.litter_robot_4_waste_drawer
        color: red
        icon: mdi:cat
        show_entity_picture: false
        visibility:
          - condition: numeric_state
            entity: sensor.litter_robot_4_waste_drawer
            above: 70
    sections:
      # ============================================================================
      # General Section
      # ============================================================================
      - type: grid
        cards:
          - type: custom:bubble-card
            card_type: separator
            name: General
            icon: mdi:home-circle
          - square: false
            type: grid
            cards:
              - type: custom:bubble-card
                card_type: button
                button_type: state
                entity: person.martin_vysnovsky
                show_state: true
                show_last_changed: true
                show_attribute: false
                card_layout: large
                icon_type: entity-picture
              - type: custom:bubble-card
                card_type: button
                button_type: state
                entity: person.lidia_silanteva
                show_state: true
                show_last_changed: true
                show_attribute: false
                card_layout: large
                icon_type: entity-picture
            columns: 2
          - show_current: true
            show_forecast: true
            type: weather-forecast
            entity: weather.forecast_home
            forecast_type: hourly
          # ============================================================================
          # Battery Levels Section - Bubble Card Design
          # ============================================================================
          - type: custom:bubble-card
            card_type: separator
            name: Battery Levels
            icon: mdi:battery-heart-variant
            styles: |
              .bubble-line { opacity: 0.5; }

          # Mobile Devices Category
          - type: custom:bubble-card
            card_type: separator
            name: Mobile Devices
            icon: mdi:cellphone-battery
            styles: |
              .bubble-line { opacity: 0.2; }
              .bubble-name { font-size: 13px; opacity: 0.7; }

          - type: grid
            square: false
            columns: 3
            cards:
              # Pixel 8 Pro Battery
              - type: custom:bubble-card
                card_type: button
                button_type: state
                entity: sensor.pixel_8_pro_battery_level
                name: Pixel 8 Pro
                icon: mdi:cellphone
                show_state: true
                show_last_changed: true
                card_layout: large-2-rows
                tap_action:
                  action: fire-dom-event
                  browser_mod:
                    service: browser_mod.popup
                    data:
                      title: Pixel 8 Pro Battery
                      content:
                        type: custom:apexcharts-card
                        graph_span: 7d
                        header:
                          show: true
                          title: Battery History
                          show_states: true
                        series:
                          - entity: sensor.pixel_8_pro_battery_level
                            name: Battery Level
                            stroke_width: 2
                            type: line
                            color: var(--catppuccin-green)
                styles: |
                  .bubble-icon-container {
                    background: ${
                      hass.states['sensor.pixel_8_pro_battery_level'].state > 60 ? 'var(--catppuccin-green)' :
                      hass.states['sensor.pixel_8_pro_battery_level'].state > 30 ? 'var(--catppuccin-yellow)' :
                      'var(--catppuccin-red)'
                    } !important;
                  }
                  ${icon.setAttribute("icon", 
                    hass.states['sensor.pixel_8_pro_battery_level'].state > 90 ? 'mdi:battery' :
                    hass.states['sensor.pixel_8_pro_battery_level'].state > 80 ? 'mdi:battery-90' :
                    hass.states['sensor.pixel_8_pro_battery_level'].state > 70 ? 'mdi:battery-80' :
                    hass.states['sensor.pixel_8_pro_battery_level'].state > 60 ? 'mdi:battery-70' :
                    hass.states['sensor.pixel_8_pro_battery_level'].state > 50 ? 'mdi:battery-60' :
                    hass.states['sensor.pixel_8_pro_battery_level'].state > 40 ? 'mdi:battery-50' :
                    hass.states['sensor.pixel_8_pro_battery_level'].state > 30 ? 'mdi:battery-40' :
                    hass.states['sensor.pixel_8_pro_battery_level'].state > 20 ? 'mdi:battery-30' :
                    hass.states['sensor.pixel_8_pro_battery_level'].state > 10 ? 'mdi:battery-20' :
                    'mdi:battery-10'
                  )}

              # iPad Battery
              - type: custom:bubble-card
                card_type: button
                button_type: state
                entity: sensor.martins_ipad_battery_level
                name: iPad
                icon: mdi:tablet
                show_state: true
                show_last_changed: true
                card_layout: large-2-rows
                tap_action:
                  action: fire-dom-event
                  browser_mod:
                    service: browser_mod.popup
                    data:
                      title: iPad Battery
                      content:
                        type: custom:apexcharts-card
                        graph_span: 7d
                        header:
                          show: true
                          title: Battery History
                          show_states: true
                        series:
                          - entity: sensor.martins_ipad_battery_level
                            name: Battery Level
                            stroke_width: 2
                            type: line
                            color: var(--catppuccin-green)
                styles: |
                  .bubble-icon-container {
                    background: ${
                      hass.states['sensor.martins_ipad_battery_level'].state > 60 ? 'var(--catppuccin-green)' :
                      hass.states['sensor.martins_ipad_battery_level'].state > 30 ? 'var(--catppuccin-yellow)' :
                      'var(--catppuccin-red)'
                    } !important;
                  }
                  ${icon.setAttribute("icon", 
                    hass.states['sensor.martins_ipad_battery_level'].state > 90 ? 'mdi:battery' :
                    hass.states['sensor.martins_ipad_battery_level'].state > 80 ? 'mdi:battery-90' :
                    hass.states['sensor.martins_ipad_battery_level'].state > 70 ? 'mdi:battery-80' :
                    hass.states['sensor.martins_ipad_battery_level'].state > 60 ? 'mdi:battery-70' :
                    hass.states['sensor.martins_ipad_battery_level'].state > 50 ? 'mdi:battery-60' :
                    hass.states['sensor.martins_ipad_battery_level'].state > 40 ? 'mdi:battery-50' :
                    hass.states['sensor.martins_ipad_battery_level'].state > 30 ? 'mdi:battery-40' :
                    hass.states['sensor.martins_ipad_battery_level'].state > 20 ? 'mdi:battery-30' :
                    hass.states['sensor.martins_ipad_battery_level'].state > 10 ? 'mdi:battery-20' :
                    'mdi:battery-10'
                  )}

              # Pixel 9a Battery
              - type: custom:bubble-card
                card_type: button
                button_type: state
                entity: sensor.pixel_9a_battery_level
                name: Lidia's Phone
                icon: mdi:cellphone
                show_state: true
                show_last_changed: true
                card_layout: large-2-rows
                tap_action:
                  action: fire-dom-event
                  browser_mod:
                    service: browser_mod.popup
                    data:
                      title: Pixel 9a Battery
                      content:
                        type: custom:apexcharts-card
                        graph_span: 7d
                        header:
                          show: true
                          title: Battery History
                          show_states: true
                        series:
                          - entity: sensor.pixel_9a_battery_level
                            name: Battery Level
                            stroke_width: 2
                            type: line
                            color: var(--catppuccin-green)
                styles: |
                  .bubble-icon-container {
                    background: ${
                      hass.states['sensor.pixel_9a_battery_level'].state > 60 ? 'var(--catppuccin-green)' :
                      hass.states['sensor.pixel_9a_battery_level'].state > 30 ? 'var(--catppuccin-yellow)' :
                      'var(--catppuccin-red)'
                    } !important;
                  }
                  ${icon.setAttribute("icon", 
                    hass.states['sensor.pixel_9a_battery_level'].state > 90 ? 'mdi:battery' :
                    hass.states['sensor.pixel_9a_battery_level'].state > 80 ? 'mdi:battery-90' :
                    hass.states['sensor.pixel_9a_battery_level'].state > 70 ? 'mdi:battery-80' :
                    hass.states['sensor.pixel_9a_battery_level'].state > 60 ? 'mdi:battery-70' :
                    hass.states['sensor.pixel_9a_battery_level'].state > 50 ? 'mdi:battery-60' :
                    hass.states['sensor.pixel_9a_battery_level'].state > 40 ? 'mdi:battery-50' :
                    hass.states['sensor.pixel_9a_battery_level'].state > 30 ? 'mdi:battery-40' :
                    hass.states['sensor.pixel_9a_battery_level'].state > 20 ? 'mdi:battery-30' :
                    hass.states['sensor.pixel_9a_battery_level'].state > 10 ? 'mdi:battery-20' :
                    'mdi:battery-10'
                  )}

          # Cleaning Robots Category
          - type: custom:bubble-card
            card_type: separator
            name: Cleaning Robots
            icon: mdi:robot-vacuum-variant
            styles: |
              .bubble-line { opacity: 0.2; }
              .bubble-name { font-size: 13px; opacity: 0.7; }

          - type: grid
            square: false
            columns: 2
            cards:
              # Roomba Battery
              - type: custom:bubble-card
                card_type: button
                button_type: state
                entity: sensor.roomba_battery
                name: Roomba
                icon: mdi:robot-vacuum
                show_state: true
                show_last_changed: true
                card_layout: large-2-rows
                tap_action:
                  action: fire-dom-event
                  browser_mod:
                    service: browser_mod.popup
                    data:
                      title: Roomba Battery
                      content:
                        type: custom:apexcharts-card
                        graph_span: 7d
                        header:
                          show: true
                          title: Battery History
                          show_states: true
                        series:
                          - entity: sensor.roomba_battery
                            name: Battery Level
                            stroke_width: 2
                            type: line
                            color: var(--catppuccin-green)
                styles: |
                  .bubble-icon-container {
                    background: ${
                      hass.states['sensor.roomba_battery'].state > 60 ? 'var(--catppuccin-green)' :
                      hass.states['sensor.roomba_battery'].state > 30 ? 'var(--catppuccin-yellow)' :
                      'var(--catppuccin-red)'
                    } !important;
                  }
                  ${icon.setAttribute("icon", 
                    hass.states['sensor.roomba_battery'].state > 90 ? 'mdi:battery' :
                    hass.states['sensor.roomba_battery'].state > 80 ? 'mdi:battery-90' :
                    hass.states['sensor.roomba_battery'].state > 70 ? 'mdi:battery-80' :
                    hass.states['sensor.roomba_battery'].state > 60 ? 'mdi:battery-70' :
                    hass.states['sensor.roomba_battery'].state > 50 ? 'mdi:battery-60' :
                    hass.states['sensor.roomba_battery'].state > 40 ? 'mdi:battery-50' :
                    hass.states['sensor.roomba_battery'].state > 30 ? 'mdi:battery-40' :
                    hass.states['sensor.roomba_battery'].state > 20 ? 'mdi:battery-30' :
                    hass.states['sensor.roomba_battery'].state > 10 ? 'mdi:battery-20' :
                    'mdi:battery-10'
                  )}

              # Xiaomi Vacuum Battery
              - type: custom:bubble-card
                card_type: button
                button_type: state
                entity: sensor.xiaomi_robot_vacuum_x20_battery_level
                name: Xiaomi Vacuum
                icon: mdi:robot-vacuum
                show_state: true
                show_last_changed: true
                card_layout: large-2-rows
                tap_action:
                  action: fire-dom-event
                  browser_mod:
                    service: browser_mod.popup
                    data:
                      title: Xiaomi Vacuum Battery
                      content:
                        type: custom:apexcharts-card
                        graph_span: 7d
                        header:
                          show: true
                          title: Battery History
                          show_states: true
                        series:
                          - entity: sensor.xiaomi_robot_vacuum_x20_battery_level
                            name: Battery Level
                            stroke_width: 2
                            type: line
                            color: var(--catppuccin-green)
                styles: |
                  .bubble-icon-container {
                    background: ${
                      hass.states['sensor.xiaomi_robot_vacuum_x20_battery_level'].state > 60 ? 'var(--catppuccin-green)' :
                      hass.states['sensor.xiaomi_robot_vacuum_x20_battery_level'].state > 30 ? 'var(--catppuccin-yellow)' :
                      'var(--catppuccin-red)'
                    } !important;
                  }
                  ${icon.setAttribute("icon", 
                    hass.states['sensor.xiaomi_robot_vacuum_x20_battery_level'].state > 90 ? 'mdi:battery' :
                    hass.states['sensor.xiaomi_robot_vacuum_x20_battery_level'].state > 80 ? 'mdi:battery-90' :
                    hass.states['sensor.xiaomi_robot_vacuum_x20_battery_level'].state > 70 ? 'mdi:battery-80' :
                    hass.states['sensor.xiaomi_robot_vacuum_x20_battery_level'].state > 60 ? 'mdi:battery-70' :
                    hass.states['sensor.xiaomi_robot_vacuum_x20_battery_level'].state > 50 ? 'mdi:battery-60' :
                    hass.states['sensor.xiaomi_robot_vacuum_x20_battery_level'].state > 40 ? 'mdi:battery-50' :
                    hass.states['sensor.xiaomi_robot_vacuum_x20_battery_level'].state > 30 ? 'mdi:battery-40' :
                    hass.states['sensor.xiaomi_robot_vacuum_x20_battery_level'].state > 20 ? 'mdi:battery-30' :
                    hass.states['sensor.xiaomi_robot_vacuum_x20_battery_level'].state > 10 ? 'mdi:battery-20' :
                    'mdi:battery-10'
                  )}

          # Smart Home Sensors Category
          - type: custom:bubble-card
            card_type: separator
            name: Smart Home Sensors
            icon: mdi:home-automation
            styles: |
              .bubble-line { opacity: 0.2; }
              .bubble-name { font-size: 13px; opacity: 0.7; }

          - type: grid
            square: false
            columns: 3
            cards:
              # Living Room Temperature Sensor
              - type: custom:bubble-card
                card_type: button
                button_type: state
                entity: sensor.living_room_temperature_battery
                name: Living Room
                icon: mdi:thermometer
                show_state: true
                show_last_changed: true
                card_layout: large-2-rows
                tap_action:
                  action: fire-dom-event
                  browser_mod:
                    service: browser_mod.popup
                    data:
                      title: Living Room Sensor Battery
                      content:
                        type: custom:apexcharts-card
                        graph_span: 30d
                        header:
                          show: true
                          title: Battery History
                          show_states: true
                        series:
                          - entity: sensor.living_room_temperature_battery
                            name: Battery Level
                            stroke_width: 2
                            type: line
                            color: var(--catppuccin-green)
                styles: |
                  .bubble-icon-container {
                    background: ${
                      hass.states['sensor.living_room_temperature_battery'].state > 60 ? 'var(--catppuccin-green)' :
                      hass.states['sensor.living_room_temperature_battery'].state > 30 ? 'var(--catppuccin-yellow)' :
                      'var(--catppuccin-red)'
                    } !important;
                  }
                  ${icon.setAttribute("icon", 
                    hass.states['sensor.living_room_temperature_battery'].state > 90 ? 'mdi:battery' :
                    hass.states['sensor.living_room_temperature_battery'].state > 80 ? 'mdi:battery-90' :
                    hass.states['sensor.living_room_temperature_battery'].state > 70 ? 'mdi:battery-80' :
                    hass.states['sensor.living_room_temperature_battery'].state > 60 ? 'mdi:battery-70' :
                    hass.states['sensor.living_room_temperature_battery'].state > 50 ? 'mdi:battery-60' :
                    hass.states['sensor.living_room_temperature_battery'].state > 40 ? 'mdi:battery-50' :
                    hass.states['sensor.living_room_temperature_battery'].state > 30 ? 'mdi:battery-40' :
                    hass.states['sensor.living_room_temperature_battery'].state > 20 ? 'mdi:battery-30' :
                    hass.states['sensor.living_room_temperature_battery'].state > 10 ? 'mdi:battery-20' :
                    'mdi:battery-10'
                  )}

              # Bedroom Temperature Sensor
              - type: custom:bubble-card
                card_type: button
                button_type: state
                entity: sensor.bedroom_temperature_battery
                name: Bedroom
                icon: mdi:thermometer
                show_state: true
                show_last_changed: true
                card_layout: large-2-rows
                tap_action:
                  action: fire-dom-event
                  browser_mod:
                    service: browser_mod.popup
                    data:
                      title: Bedroom Sensor Battery
                      content:
                        type: custom:apexcharts-card
                        graph_span: 30d
                        header:
                          show: true
                          title: Battery History
                          show_states: true
                        series:
                          - entity: sensor.bedroom_temperature_battery
                            name: Battery Level
                            stroke_width: 2
                            type: line
                            color: var(--catppuccin-green)
                styles: |
                  .bubble-icon-container {
                    background: ${
                      hass.states['sensor.bedroom_temperature_battery'].state > 60 ? 'var(--catppuccin-green)' :
                      hass.states['sensor.bedroom_temperature_battery'].state > 30 ? 'var(--catppuccin-yellow)' :
                      'var(--catppuccin-red)'
                    } !important;
                  }
                  ${icon.setAttribute("icon", 
                    hass.states['sensor.bedroom_temperature_battery'].state > 90 ? 'mdi:battery' :
                    hass.states['sensor.bedroom_temperature_battery'].state > 80 ? 'mdi:battery-90' :
                    hass.states['sensor.bedroom_temperature_battery'].state > 70 ? 'mdi:battery-80' :
                    hass.states['sensor.bedroom_temperature_battery'].state > 60 ? 'mdi:battery-70' :
                    hass.states['sensor.bedroom_temperature_battery'].state > 50 ? 'mdi:battery-60' :
                    hass.states['sensor.bedroom_temperature_battery'].state > 40 ? 'mdi:battery-50' :
                    hass.states['sensor.bedroom_temperature_battery'].state > 30 ? 'mdi:battery-40' :
                    hass.states['sensor.bedroom_temperature_battery'].state > 20 ? 'mdi:battery-30' :
                    hass.states['sensor.bedroom_temperature_battery'].state > 10 ? 'mdi:battery-20' :
                    'mdi:battery-10'
                  )}

              # Bathroom Temperature Sensor
              - type: custom:bubble-card
                card_type: button
                button_type: state
                entity: sensor.bathroom_temperature_battery
                name: Bathroom
                icon: mdi:thermometer
                show_state: true
                show_last_changed: true
                card_layout: large-2-rows
                tap_action:
                  action: fire-dom-event
                  browser_mod:
                    service: browser_mod.popup
                    data:
                      title: Bathroom Sensor Battery
                      content:
                        type: custom:apexcharts-card
                        graph_span: 30d
                        header:
                          show: true
                          title: Battery History
                          show_states: true
                        series:
                          - entity: sensor.bathroom_temperature_battery
                            name: Battery Level
                            stroke_width: 2
                            type: line
                            color: var(--catppuccin-green)
                styles: |
                  .bubble-icon-container {
                    background: ${
                      hass.states['sensor.bathroom_temperature_battery'].state > 60 ? 'var(--catppuccin-green)' :
                      hass.states['sensor.bathroom_temperature_battery'].state > 30 ? 'var(--catppuccin-yellow)' :
                      'var(--catppuccin-red)'
                    } !important;
                  }
                  ${icon.setAttribute("icon", 
                    hass.states['sensor.bathroom_temperature_battery'].state > 90 ? 'mdi:battery' :
                    hass.states['sensor.bathroom_temperature_battery'].state > 80 ? 'mdi:battery-90' :
                    hass.states['sensor.bathroom_temperature_battery'].state > 70 ? 'mdi:battery-80' :
                    hass.states['sensor.bathroom_temperature_battery'].state > 60 ? 'mdi:battery-70' :
                    hass.states['sensor.bathroom_temperature_battery'].state > 50 ? 'mdi:battery-60' :
                    hass.states['sensor.bathroom_temperature_battery'].state > 40 ? 'mdi:battery-50' :
                    hass.states['sensor.bathroom_temperature_battery'].state > 30 ? 'mdi:battery-40' :
                    hass.states['sensor.bathroom_temperature_battery'].state > 20 ? 'mdi:battery-30' :
                    hass.states['sensor.bathroom_temperature_battery'].state > 10 ? 'mdi:battery-20' :
                    'mdi:battery-10'
                  )}

              # Living Room Curtain Left
              - type: custom:bubble-card
                card_type: button
                button_type: state
                entity: sensor.living_room_curtain_left_battery
                name: Curtain Left
                icon: mdi:curtains
                show_state: true
                show_last_changed: true
                card_layout: large-2-rows
                tap_action:
                  action: fire-dom-event
                  browser_mod:
                    service: browser_mod.popup
                    data:
                      title: Left Curtain Battery
                      content:
                        type: custom:apexcharts-card
                        graph_span: 30d
                        header:
                          show: true
                          title: Battery History
                          show_states: true
                        series:
                          - entity: sensor.living_room_curtain_left_battery
                            name: Battery Level
                            stroke_width: 2
                            type: line
                            color: var(--catppuccin-green)
                styles: |
                  .bubble-icon-container {
                    background: ${
                      hass.states['sensor.living_room_curtain_left_battery'].state > 60 ? 'var(--catppuccin-green)' :
                      hass.states['sensor.living_room_curtain_left_battery'].state > 30 ? 'var(--catppuccin-yellow)' :
                      'var(--catppuccin-red)'
                    } !important;
                  }
                  ${icon.setAttribute("icon", 
                    hass.states['sensor.living_room_curtain_left_battery'].state > 90 ? 'mdi:battery' :
                    hass.states['sensor.living_room_curtain_left_battery'].state > 80 ? 'mdi:battery-90' :
                    hass.states['sensor.living_room_curtain_left_battery'].state > 70 ? 'mdi:battery-80' :
                    hass.states['sensor.living_room_curtain_left_battery'].state > 60 ? 'mdi:battery-70' :
                    hass.states['sensor.living_room_curtain_left_battery'].state > 50 ? 'mdi:battery-60' :
                    hass.states['sensor.living_room_curtain_left_battery'].state > 40 ? 'mdi:battery-50' :
                    hass.states['sensor.living_room_curtain_left_battery'].state > 30 ? 'mdi:battery-40' :
                    hass.states['sensor.living_room_curtain_left_battery'].state > 20 ? 'mdi:battery-30' :
                    hass.states['sensor.living_room_curtain_left_battery'].state > 10 ? 'mdi:battery-20' :
                    'mdi:battery-10'
                  )}

              # Living Room Curtain Right
              - type: custom:bubble-card
                card_type: button
                button_type: state
                entity: sensor.living_room_curtain_right_battery
                name: Curtain Right
                icon: mdi:curtains
                show_state: true
                show_last_changed: true
                card_layout: large-2-rows
                tap_action:
                  action: fire-dom-event
                  browser_mod:
                    service: browser_mod.popup
                    data:
                      title: Right Curtain Battery
                      content:
                        type: custom:apexcharts-card
                        graph_span: 30d
                        header:
                          show: true
                          title: Battery History
                          show_states: true
                        series:
                          - entity: sensor.living_room_curtain_right_battery
                            name: Battery Level
                            stroke_width: 2
                            type: line
                            color: var(--catppuccin-green)
                styles: |
                  .bubble-icon-container {
                    background: ${
                      hass.states['sensor.living_room_curtain_right_battery'].state > 60 ? 'var(--catppuccin-green)' :
                      hass.states['sensor.living_room_curtain_right_battery'].state > 30 ? 'var(--catppuccin-yellow)' :
                      'var(--catppuccin-red)'
                    } !important;
                  }
                  ${icon.setAttribute("icon", 
                    hass.states['sensor.living_room_curtain_right_battery'].state > 90 ? 'mdi:battery' :
                    hass.states['sensor.living_room_curtain_right_battery'].state > 80 ? 'mdi:battery-90' :
                    hass.states['sensor.living_room_curtain_right_battery'].state > 70 ? 'mdi:battery-80' :
                    hass.states['sensor.living_room_curtain_right_battery'].state > 60 ? 'mdi:battery-70' :
                    hass.states['sensor.living_room_curtain_right_battery'].state > 50 ? 'mdi:battery-60' :
                    hass.states['sensor.living_room_curtain_right_battery'].state > 40 ? 'mdi:battery-50' :
                    hass.states['sensor.living_room_curtain_right_battery'].state > 30 ? 'mdi:battery-40' :
                    hass.states['sensor.living_room_curtain_right_battery'].state > 20 ? 'mdi:battery-30' :
                    hass.states['sensor.living_room_curtain_right_battery'].state > 10 ? 'mdi:battery-20' :
                    'mdi:battery-10'
                  )}

              # Plant Sensor
              - type: custom:bubble-card
                card_type: button
                button_type: state
                entity: sensor.plant_sensor_d766_battery
                name: Plant Sensor
                icon: mdi:flower
                show_state: true
                show_last_changed: true
                card_layout: large-2-rows
                tap_action:
                  action: fire-dom-event
                  browser_mod:
                    service: browser_mod.popup
                    data:
                      title: Plant Sensor Battery
                      content:
                        type: custom:apexcharts-card
                        graph_span: 30d
                        header:
                          show: true
                          title: Battery History
                          show_states: true
                        series:
                          - entity: sensor.plant_sensor_d766_battery
                            name: Battery Level
                            stroke_width: 2
                            type: line
                            color: var(--catppuccin-green)
                styles: |
                  .bubble-icon-container {
                    background: ${
                      hass.states['sensor.plant_sensor_d766_battery'].state > 60 ? 'var(--catppuccin-green)' :
                      hass.states['sensor.plant_sensor_d766_battery'].state > 30 ? 'var(--catppuccin-yellow)' :
                      'var(--catppuccin-red)'
                    } !important;
                  }
                  ${icon.setAttribute("icon", 
                    hass.states['sensor.plant_sensor_d766_battery'].state > 90 ? 'mdi:battery' :
                    hass.states['sensor.plant_sensor_d766_battery'].state > 80 ? 'mdi:battery-90' :
                    hass.states['sensor.plant_sensor_d766_battery'].state > 70 ? 'mdi:battery-80' :
                    hass.states['sensor.plant_sensor_d766_battery'].state > 60 ? 'mdi:battery-70' :
                    hass.states['sensor.plant_sensor_d766_battery'].state > 50 ? 'mdi:battery-60' :
                    hass.states['sensor.plant_sensor_d766_battery'].state > 40 ? 'mdi:battery-50' :
                    hass.states['sensor.plant_sensor_d766_battery'].state > 30 ? 'mdi:battery-40' :
                    hass.states['sensor.plant_sensor_d766_battery'].state > 20 ? 'mdi:battery-30' :
                    hass.states['sensor.plant_sensor_d766_battery'].state > 10 ? 'mdi:battery-20' :
                    'mdi:battery-10'
                  )}

      # ============================================================================
      # Home Controls Section
      # ============================================================================
      - type: grid
        cards:
          - type: custom:bubble-card
            card_type: separator
            name: Home
            icon: mdi:home-outline
          - type: custom:bubble-card
            card_type: separator
            name: Living Room
            icon: mdi:sofa
            styles: |
              .bubble-line { opacity: 0.2; }
              .bubble-name { font-size: 13px; opacity: 0.7; }
          - type: custom:bubble-card
            card_type: button
            button_type: state
            entity: group.living_room_curtains
            name: Living Room Curtains
            icon: mdi:curtains
            show_state: true
            state_background: true
            state_color: true
            grid_options:
              columns: full
          - type: custom:bubble-card
            card_type: media-player
            entity: media_player.living_room_speaker
            visibility:
              - condition: state
                entity: media_player.living_room_speaker
                state_not: "off"
          - type: custom:bubble-card
            card_type: separator
            name: Vacuum Cleaner
            icon: mdi:robot-vacuum
            styles: |
              .bubble-line { opacity: 0.2; }
              .bubble-name { font-size: 13px; opacity: 0.7; }
          - type: custom:vacuum-card
            entity: vacuum.xiaomi_robot_vacuum_x20
            map: camera.xiaomi_robot_vacuum_x20_map

      # ============================================================================
      # Motion Detection & Scenes Section
      # ============================================================================
      - type: grid
        cards:
          # Home motion detection with scene control
          - type: custom:bubble-card
            card_type: separator
            name: Home Motion Detection
            icon: mdi:motion-sensor
            sub_button:
              - entity: input_boolean.home_away_mode
                show_name: true
                show_state: false
                show_background: true
                tap_action:
                  action: toggle
            styles: |
              ${subButtonIcon[0].setAttribute("icon", hass.states['input_boolean.home_away_mode'].state === 'on' ? 'mdi:home' : 'mdi:home-export-outline')}
              ${(() => {
                const nameElement = card.querySelector('.bubble-sub-button-container .bubble-name');
                if (nameElement) {
                  nameElement.innerText = hass.states['input_boolean.home_away_mode'].state === 'on' ? 'Present' : 'Away';
                }
              })()}
          - square: false
            type: grid
            cards:
              - square: false
                type: grid
                cards:
                  - type: custom:bubble-card
                    card_type: button
                    button_type: state
                    entity: select.living_room_motion_detection
                    name: Living room
                    show_state: true
                    show_last_changed: true
                    show_attribute: false
                    card_layout: large-2-rows
                    styles: |
                      .bubble-icon-container {
                        background: ${hass.states['select.living_room_motion_detection'].state === 'off' ? 'rgba(150,150,150,0.5)' : 'var(--accent-color)'} !important;
                      }
                      ${icon.setAttribute("icon", hass.states['select.living_room_motion_detection'].state === 'off' ? 'mdi:motion-sensor-off' : 'mdi:motion-sensor')}
                  - type: custom:bubble-card
                    card_type: button
                    button_type: state
                    entity: select.kitchen_motion_detection
                    name: Kitchen
                    show_state: true
                    show_last_changed: true
                    show_attribute: false
                    card_layout: large-2-rows
                    styles: |
                      .bubble-icon-container {
                        background: ${hass.states['select.kitchen_motion_detection'].state === 'off' ? 'rgba(150,150,150,0.5)' : 'var(--accent-color)'} !important;
                      }
                      ${icon.setAttribute("icon", hass.states['select.kitchen_motion_detection'].state === 'off' ? 'mdi:motion-sensor-off' : 'mdi:motion-sensor')}
                  - type: custom:bubble-card
                    card_type: button
                    button_type: state
                    entity: select.bedroom_motion_detection
                    name: Bedroom
                    show_state: true
                    show_last_changed: true
                    show_attribute: false
                    card_layout: large-2-rows
                    styles: |
                      .bubble-icon-container {
                        background: ${hass.states['select.bedroom_motion_detection'].state === 'off' ? 'rgba(150,150,150,0.5)' : 'var(--accent-color)'} !important;
                      }
                      ${icon.setAttribute("icon", hass.states['select.bedroom_motion_detection'].state === 'off' ? 'mdi:motion-sensor-off' : 'mdi:motion-sensor')}
                  - type: custom:bubble-card
                    card_type: button
                    button_type: state
                    entity: select.hall_motion_detection
                    name: Hall
                    show_state: true
                    show_last_changed: true
                    show_attribute: false
                    card_layout: large-2-rows
                    styles: |
                      .bubble-icon-container {
                        background: ${hass.states['select.hall_motion_detection'].state === 'off' ? 'rgba(150,150,150,0.5)' : 'var(--accent-color)'} !important;
                      }
                      ${icon.setAttribute("icon", hass.states['select.hall_motion_detection'].state === 'off' ? 'mdi:motion-sensor-off' : 'mdi:motion-sensor')}
                columns: 4
              - type: custom:bubble-card
                card_type: separator
                name: Kvetoslavov Motion Detection
                icon: mdi:motion-sensor
                sub_button:
                  - entity: input_boolean.kvetoslavov_home_away_mode
                    show_name: true
                    show_state: false
                    show_background: true
                    tap_action:
                      action: toggle
                styles: |
                  ${subButtonIcon[0].setAttribute("icon", hass.states['input_boolean.kvetoslavov_home_away_mode'].state === 'on' ? 'mdi:home' : 'mdi:home-export-outline')}
                  ${(() => {
                    const nameElement = card.querySelector('.bubble-sub-button-container .bubble-name');
                    if (nameElement) {
                      nameElement.innerText = hass.states['input_boolean.kvetoslavov_home_away_mode'].state === 'on' ? 'Present' : 'Away';
                    }
                  })()}
              - square: false
                type: grid
                cards:
                  - type: custom:bubble-card
                    card_type: button
                    button_type: switch
                    entity: switch.camera_front_disarming
                    name: Front
                    show_state: true
                    show_last_changed: true
                    show_attribute: false
                    card_layout: large-2-rows
                    styles: |
                      .bubble-icon-container {
                        background: ${hass.states['switch.camera_front_disarming'].state === 'off' ? 'var(--accent-color)' : 'rgba(150,150,150,0.5)'} !important;
                      }
                      .bubble-button-background {
                        opacity: ${hass.states['switch.camera_front_disarming'].state === 'off' ? '1' : '0'} !important;
                      }
                      .bubble-icon {
                        color: ${hass.states['switch.camera_front_disarming'].state === 'off' ? 'var(--primary-text-color)' : 'rgba(150,150,150,0.8)'} !important;
                      }
                      ${icon.setAttribute("icon", hass.states['switch.camera_front_disarming'].state === 'off' ? 'mdi:cctv' : 'mdi:cctv-off')}
                  - type: custom:bubble-card
                    card_type: button
                    button_type: switch
                    entity: switch.camera_parking_disarming
                    name: Parking
                    show_state: true
                    show_last_changed: true
                    show_attribute: false
                    card_layout: large-2-rows
                    styles: |
                      .bubble-icon-container {
                        background: ${hass.states['switch.camera_parking_disarming'].state === 'off' ? 'var(--accent-color)' : 'rgba(150,150,150,0.5)'} !important;
                      }
                      .bubble-button-background {
                        opacity: ${hass.states['switch.camera_parking_disarming'].state === 'off' ? '1' : '0'} !important;
                      }
                      .bubble-icon {
                        color: ${hass.states['switch.camera_parking_disarming'].state === 'off' ? 'var(--primary-text-color)' : 'rgba(150,150,150,0.8)'} !important;
                      }
                      ${icon.setAttribute("icon", hass.states['switch.camera_parking_disarming'].state === 'off' ? 'mdi:cctv' : 'mdi:cctv-off')}
                  - type: custom:bubble-card
                    card_type: button
                    button_type: switch
                    entity: switch.camera_terrace_disarming
                    name: Terrace
                    show_state: true
                    show_last_changed: true
                    show_attribute: false
                    card_layout: large-2-rows
                    styles: |
                      .bubble-icon-container {
                        background: ${hass.states['switch.camera_terrace_disarming'].state === 'off' ? 'var(--accent-color)' : 'rgba(150,150,150,0.5)'} !important;
                      }
                      .bubble-button-background {
                        opacity: ${hass.states['switch.camera_terrace_disarming'].state === 'off' ? '1' : '0'} !important;
                      }
                      .bubble-icon {
                        color: ${hass.states['switch.camera_terrace_disarming'].state === 'off' ? 'var(--primary-text-color)' : 'rgba(150,150,150,0.8)'} !important;
                      }
                      ${icon.setAttribute("icon", hass.states['switch.camera_terrace_disarming'].state === 'off' ? 'mdi:cctv' : 'mdi:cctv-off')}
            columns: 1
          - type: custom:apexcharts-card
            graph_span: 30d
            span:
              end: day
            show:
              last_updated: true
            header:
              show: true
              title: Kvetoslavov occupancy
              show_states: true
              colorize_states: true
            yaxis:
              - min: 0
                max: ~6
                decimals: 0
            series:
              - entity: sensor.kvetoslavov_occupied
                type: column
                name: Duration
                show:
                  as_duration: hour
                group_by:
                  func: last
                  duration: 1d

      # ============================================================================
      # Temperature and Humidity Section
      # ============================================================================
      - type: grid
        cards:
          - type: custom:bubble-card
            card_type: separator
            name: Temperature and humidity
            icon: mdi:thermometer
          # Living room temperature
          - &temperature_card_base
            type: custom:bubble-card
            card_type: button
            button_type: state
            show_state: true
            show_last_changed: false
            card_layout: large
            scrolling_effect: false
            show_icon: true
            entity: sensor.living_room_temperature
            name: Living room
            styles: |
              .bubble-button-card-container {
                position: relative !important;
                background: transparent !important;
              }
              .bubble-button-card-container::before {
                content: '' !important;
                position: absolute !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                bottom: 0 !important;
                z-index: 0 !important;
                border-radius: inherit !important;
                background: linear-gradient(90deg,
                  #8caaee 0%,
                  #a6d189 33.33%,
                  #e5c890 66.67%,
                  #e78284 100%) !important;
                -webkit-mask-image: linear-gradient(90deg,
                  black 0%,
                  black calc((${hass.states['sensor.living_room_temperature'].state} - 15) / 15 * 100%),
                  rgba(0, 0, 0, 0.2) calc((${hass.states['sensor.living_room_temperature'].state} - 15) / 15 * 100%),
                  rgba(0, 0, 0, 0.2) 100%) !important;
                mask-image: linear-gradient(90deg,
                  black 0%,
                  black calc((${hass.states['sensor.living_room_temperature'].state} - 15) / 15 * 100%),
                  rgba(0, 0, 0, 0.2) calc((${hass.states['sensor.living_room_temperature'].state} - 15) / 15 * 100%),
                  rgba(0, 0, 0, 0.2) 100%) !important;
              }
              .bubble-button-card-container > * {
                position: relative !important;
                z-index: 1 !important;
              }
              .bubble-sub-button {
                background: rgba(255, 255, 255, 0.2) !important;
              }
            sub_button:
              - &humidity_button_base
                show_state: true
                show_name: true
                name: Humidity
                icon: mdi:water-percent
                show_icon: true
                entity: sensor.living_room_temperature_humidity

          # Bedroom temperature
          - <<: *temperature_card_base
            entity: sensor.bedroom_temperature
            name: Bedroom
            styles: |
              .bubble-button-card-container {
                position: relative !important;
                background: transparent !important;
              }
              .bubble-button-card-container::before {
                content: '' !important;
                position: absolute !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                bottom: 0 !important;
                z-index: 0 !important;
                border-radius: inherit !important;
                background: linear-gradient(90deg,
                  #8caaee 0%,
                  #a6d189 33.33%,
                  #e5c890 66.67%,
                  #e78284 100%) !important;
                -webkit-mask-image: linear-gradient(90deg,
                  black 0%,
                  black calc((${hass.states['sensor.bedroom_temperature'].state} - 15) / 15 * 100%),
                  rgba(0, 0, 0, 0.2) calc((${hass.states['sensor.bedroom_temperature'].state} - 15) / 15 * 100%),
                  rgba(0, 0, 0, 0.2) 100%) !important;
                mask-image: linear-gradient(90deg,
                  black 0%,
                  black calc((${hass.states['sensor.bedroom_temperature'].state} - 15) / 15 * 100%),
                  rgba(0, 0, 0, 0.2) calc((${hass.states['sensor.bedroom_temperature'].state} - 15) / 15 * 100%),
                  rgba(0, 0, 0, 0.2) 100%) !important;
              }
              .bubble-button-card-container > * {
                position: relative !important;
                z-index: 1 !important;
              }
              .bubble-sub-button {
                background: rgba(255, 255, 255, 0.2) !important;
              }
            sub_button:
              - <<: *humidity_button_base
                entity: sensor.bedroom_temperature_humidity

          # Bathroom temperature
          - <<: *temperature_card_base
            entity: sensor.bathroom_temperature
            name: Bathroom
            styles: |
              .bubble-button-card-container {
                position: relative !important;
                background: transparent !important;
              }
              .bubble-button-card-container::before {
                content: '' !important;
                position: absolute !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                bottom: 0 !important;
                z-index: 0 !important;
                border-radius: inherit !important;
                background: linear-gradient(90deg,
                  #8caaee 0%,
                  #a6d189 33.33%,
                  #e5c890 66.67%,
                  #e78284 100%) !important;
                -webkit-mask-image: linear-gradient(90deg,
                  black 0%,
                  black calc((${hass.states['sensor.bathroom_temperature'].state} - 15) / 15 * 100%),
                  rgba(0, 0, 0, 0.2) calc((${hass.states['sensor.bathroom_temperature'].state} - 15) / 15 * 100%),
                  rgba(0, 0, 0, 0.2) 100%) !important;
                mask-image: linear-gradient(90deg,
                  black 0%,
                  black calc((${hass.states['sensor.bathroom_temperature'].state} - 15) / 15 * 100%),
                  rgba(0, 0, 0, 0.2) calc((${hass.states['sensor.bathroom_temperature'].state} - 15) / 15 * 100%),
                  rgba(0, 0, 0, 0.2) 100%) !important;
              }
              .bubble-button-card-container > * {
                position: relative !important;
                z-index: 1 !important;
              }
              .bubble-sub-button {
                background: rgba(255, 255, 255, 0.2) !important;
              }
            sub_button:
              - <<: *humidity_button_base
                entity: sensor.bathroom_temperature_humidity
          - type: custom:bubble-card
            card_type: climate
            entity: climate.air_conditioner_2
            card_layout: large
            sub_button:
              - name: HVAC modes menu
                select_attribute: hvac_modes
                state_background: false
                show_arrow: false
